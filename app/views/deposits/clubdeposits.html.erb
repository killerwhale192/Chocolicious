<% if flash[:error] %> <font color="red"><%= flash[:error]%></font>
<%end%>
<% role = session[:role]%>
<%statuscode = ['Unsubmitted', 'With Club Finsec', 'With Club Pres', 'With CBD Finsec', 'With OFIN', 'Done', 'Unsubmitted', 'With CBD Finsec', 'With CBD Pres', 'With SMUSA Finsec', 'With OFIN', 'Done', 'Unsubmitted', 'With SMUSA Pres','With SMUSA Finsec', 'With OFIN', 'Done']%>

<div class='row'>
	<div class='col-sm-12'>
		<div class='page-header'>
			<h1 class='pull-left'><i class='icon-file-alt'></i><span>Manage Club Deposits</span></h1>

		</div>
	</div>
</div>
<%if role.include? 'clubfinsec'%>

<div class='row'>

	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					Club deposits
				</div>
				<div class="actions">


					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @normaldeposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 1%>
								<a href="/deposits/editdeposit?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Edit'><i class="icon-pencil"></i></a> 
								<%if c.remarks.nil?%>
								<a href="/deposits/submitdeposit?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Submit'><i class="icon-share-alt"></i></a> 
								<%else%>
								<a href="/deposits/submitdeposit?id=<%= c.id%>" class="btn btn-info btn-xs has-tooltip" data-placement='top' title='Resubmit'><i class="icon-share-alt"></i></a>
								<a href="#", onclick="viewremark('<%= c.remarks%>')" class="btn btn-warning btn-xs has-tooltip" data-placement='top' title='View Remarks'><i class="icon-eye-open"></i></a>
								<%end%>
								<a href="/deposits/deletedeposit?id=<%=c.id%>&own=true" class="btn btn-danger btn-xs has-tooltip" data-placement='top' title='Delete'><i class="icon-remove"></i></a>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>
<%elsif role.include? 'cbdfinsec'%>
<div class='row'>


          <!-- CBD deposits from here               -->

	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					Club deposits
				</div>
				<div class="actions">

					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @normaldeposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
									
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 3%>
								<a href="/deposits/endorseclub?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Endorse'><i class="icon-thumbs-up-alt"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=1" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a>
								<%elsif status == 4%>
								<a href="/deposits/endorseclub?id=<%= c.id%>" class="btn btn-warning btn-xs has-tooltip" data-placement='top' title='View Endorsed Form'><i class="icon-eye-open"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=1" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a>
								<a href="/deposits/completedeposit?id=<%= c.id%>" class="btn btn-success btn-xs">Deposit Complete</a>
								<%elsif status == 5%>
								<span class="label label-success">Deposit Completed</span>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>
<!-- CBD deposits from here               -->

<div class='row'>

	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					CBD deposits
				</div>
				<div class="actions">

					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @cbdmcdeposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 7%>
								<a href="/deposits/editdeposit?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Edit'><i class="icon-pencil"></i></a>
								<%if c.remarks.nil?%>
								<a href="/deposits/submitdeposit?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Submit'><i class="icon-share-alt"></i></a>
								<%else%>
								<a href="/deposits/resubmitdeposit?id=<%= c.id%>" class="btn btn-info btn-xs has-tooltip" data-placement='top' title='Resubmit'><i class="icon-share-alt"></i></a>
								<a href="#", onclick="viewremark('<%= c.remarks%>')" class="btn btn-warning btn-xs has-tooltip" data-placement='top' title='View Remarks'><i class="icon-eye-open"></i></a>
								<%end%>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>

<%elsif role.include? 'president'%>
<div class='row'>

	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					Club deposits
				</div>
				<div class="actions">

					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @deposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 2 || status == 8 || status == 13%>
								<a href="#", onclick="pres(<%= c.id%>)" class="btn btn-success btn-xs">Acknowledge</a>
								<%if status == 2%>
								<a href="/deposits/addremark?id=<%=c.id%>&status=1" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a> 
								<%elsif status == 8%>
								<a href="/deposits/addremark?id=<%=c.id%>&status=6" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a> 
								<%elsif status == 13%>
								<a href="/deposits/addremark?id=<%=c.id%>&status=12" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a> 
								<%end%>
								<p id ="pres"></p>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>
<%elsif role.include? 'smusafinsec'%>
<div class='row'>


	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					CBD MC deposits
				</div>
				<div class="actions">

					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @cbdmcdeposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 9%>
								<a href="/deposits/endorsecbdmc?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Endorse'><i class="icon-thumbs-up-alt"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=6" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a> 
								<%elsif status == 10%>
								<a href="/deposits/endorsecbdmc?id=<%= c.id%>" class="btn btn-warning btn-xs has-tooltip" data-placement='top' title='View Endorsed Form'><i class="icon-eye-open"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=6" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a> 
								<a href="/deposits/completedeposit?id=<%= c.id%>" class="btn btn-success btn-xs">deposit complete</a>
								<%elsif status == 11%>
								<span class="label label-success">Deposit Completed</span>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>

<div class='row'>


	<div class="col-sm-12">
		<div class="box bordered-box blue-border">
			<div class="box-header blue-background">
				<div class="title">
					SMUSA Secretary deposits
				</div>
				<div class="actions">

					<a class="btn box-collapse btn-xs btn-link" href="#"><i></i> </a>
				</div>
			</div>
			<div class="box-content box-no-padding">
				<div class="responsive-table">
					<div class="scrollable-area">

						<table class="data-table table table-striped" style="margin-bottom:0;">
							<thead>
								<th>ID</th>
								<th>Deposit By</th>
								<th>Club</th>
								<th>Amount</th>
								<th>Date</th>
								<th>Receipt Nos</th>
								<th>Donor Name</th>
								
								<th>Donor IC</th>
								
								<th>Details</th>
								<th>Status</th>

								<th>Action</th>

							</thead>
							<tbody>
							<% @smusasecdeposits.each do |c|%>
							<% status = c.status%>
							<%if c.remarks.nil?%>
							<tr>
								<%else%>
							<tr class = 'warning'>
								<%end%>
								<td><%= c.id%></td>
								<td><%= c.userid%></td>
								<td><%= c.clubid%></td>
								<td>$<%= c.amount%></td>
								<td><%= c.date%></td>
								<td><%= c.receipts%></td>
								<td><%= c.donorname%></td>
								
								<td><%= c.donoric%></td>
								
								<td>
									<div class="bs-example-tooltips">
										<button type="button" class="btn btn-warning btn-xs" data-container="body" data-toggle="popover-with-html" data-placement="top" data-content="<b>Purpose:</b><br /><%= c.purpose%><br /><b>Donor Address:</b><br /><%= c.donoradd%><br /><b>Created:</b><br /><%= c.created_at%><br /><b>Last Updated:</b><br /><%= c.updated_at%>" data-original-title="" title="Details (<%= c.clubid%>)">Details</button>
									<a href="<%= c.supportdoc.url%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Download Attachment'><i class="icon-arrow-down"></i></a>
		
									</div>
								</td>
								<td><%= statuscode[c.status]%></td>
								<td>
								<%if status == 14%>
								<a href="/deposits/endorsesmusasec?id=<%= c.id%>" class="btn btn-success btn-xs has-tooltip" data-placement='top' title='Endorse'><i class="icon-thumbs-up-alt"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=12" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a>
								<%elsif status == 15%>
								<a href="/deposits/endorsesmusasec?id=<%= c.id%>" class="btn btn-warning btn-xs has-tooltip" data-placement='top' title='View Endorsed Form'><i class="icon-eye-open"></i></a>
								<a href="/deposits/addremark?id=<%= c.id%>&status=12" class="btn btn-xs btn-danger has-tooltip" data-placement='top' title='Reject'><i class="icon-thumbs-down-alt"></i></a>
								<a href="/deposits/completedeposit?id=<%= c.id%>" class="btn btn-success btn-xs">Deposit complete</a>
								<%elsif status == 16%>
								<span class="label label-success">Deposit Completed</span>
								<%end%>
							</td></tr>
							<%end%>
</tbody>
						</table>

					</div>
				</div>
			</div>
		</div>
	</div>

</div>

<%end%>

<%=javascript_tag do%>

function pres(a){
var x;
if (confirm("You are going to acknowlege the deposit!")==true){
window.location = "/deposits/submitdeposit?id="+a;
}

}
function viewremark(a){

alert(a);

}
<%end%>
<script type="text/javascript">
	$('[data-toggle="popover-with-html"]').popover({ html : true });
	
	$('body').on('click', function (e) {
	    $('[data-toggle="popover"]').each(function () {
	        //the 'is' for buttons that trigger popups
	        //the 'has' for icons within a button that triggers a popup
	        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
	            $(this).popover('hide');
	        }
	    });
	});
</script>
